function OipaSelection(){this.cities=[];this.countries=[];this.regions=[];this.sectors=[];this.budgets=[];this.query=[];this.indicators=[];this.reporting_organisation=null;this.get_selection_from_url=function(){var e=window.location.search.substring(1);if(e!=""){var t=e.split("&");for(var n=0;n<t.length;n++){var r=t[n].split("="),i=r[1].split(",");current_selection[r[0]]=[];for(var s=0;s<i.length;s++)r[0]!="query"?this[r[0]].push({id:i[s],name:"unknown"}):this[r[0]].push({id:i[s],name:i[s]})}}}}function OipaProjectList(){this.offset=0;this.per_page=25;this.order_by=null}function OipaMap(){this.map=null;this.selection=null;this.slider=null;this.basemap="zimmerman2014.hmj09g6h";this.tl=null;this.set_map=function(e){$("#"+e).css("min-height","300px");this.map=L.map(e,{attributionControl:!1,scrollWheelZoom:!1,zoom:3,minZoom:2,maxZoom:12,continuousWorld:"true"}).setView([10.505,25.09],3);this.tl=L.tileLayer("https://{s}.tiles.mapbox.com/v3/"+this.basemap+"/{z}/{x}/{y}.png",{maxZoom:12}).addTo(this.map)};this.refresh=function(){};this.change_basemap=function(e){this.tl._url="https://{s}.tiles.mapbox.com/v3/"+e+"/{z}/{x}/{y}.png";this.tl.redraw()}}function OipaFilters(){this.create_filter_attributes=function(e,t){var n="",r=20,i=[];for(var s in e)i.push([s,e[s]]);i.sort(function(e,t){var n=e[1].toString().toLowerCase(),r=t[1].toString().toLowerCase();return n<r?-1:n>r?1:0});var o=1;n+='<div class="filter-page filter-page-1">';for(var u=0;u<i.length;u++){u%r==0&&(n+='<div class="span'+12/t+'">');var a=i[u][1];t==4&&a.length>32?a=a.substr(0,28)+"...":t==3&&a.length>40&&(a=a.substr(0,36)+"...");n+='<div class="squaredThree"><div>';n+='<input type="checkbox" value="'+i[u][0]+'" id="'+i[u][1].toString().replace(/ /g,"").replace(",","").replace("&","").replace("%","perc")+'" name="'+i[u][1]+'" />';n+='<label class="map-filter-cb-value" for="'+i[u][1].toString().replace(/ /g,"").replace(",","").replace("&","").replace("%","perc")+'"></label>';n+='</div><div class="squaredThree-fname"><span>'+a+"</span></div></div>";u%r==r-1&&(n+="</div>");if(u+1>o*r*t-1){n+="</div>";o+=1;n+='<div class="filter-page filter-page-'+o+'">'}}n+='<div class="filter-total-pages" name="'+o+'"></div>';o>1&&(n+="</div>");return n}}function ProjectFilters(){function e(e,t){var n="",r=20,i=[];for(var s in e){e[s].name==null&&(e[s].name="Unknown");i.push([s,e[s]])}i.sort(function(e,t){var n=e[1].name.toString().toLowerCase(),r=t[1].name.toString().toLowerCase();return n<r?-1:n>r?1:0});var o=1;n+='<div class="filter-page filter-page-1">';for(var u=0;u<i.length;u++){u%r==0&&(n+='<div class="span'+12/t+'">');var a=i[u][1].name;t==4&&a.length>32?a=a.substr(0,28)+"...":t==3&&a.length>46&&(a=a.substr(0,42)+"...");var f=i[u][1].total.toString();n+='<div class="squaredThree"><div>';n+='<input type="checkbox" value="'+i[u][0]+'" id="'+i[u][0]+i[u][1].name.toString().replace(/ /g,"").replace(",","").replace("&","").replace("%","perc")+'" name="'+i[u][1].name+'" />';n+='<label class="map-filter-cb-value" for="'+i[u][0]+i[u][1].name.toString().replace(/ /g,"").replace(",","").replace("&","").replace("%","perc")+'"></label>';n+='</div><div class="squaredThree-fname"><span>'+a+" ("+f+")</span></div></div>";u%r==r-1&&(n+="</div>");if(u+1>o*r*t-1){n+="</div>";o+=1;n+='<div class="filter-page filter-page-'+o+'">'}}n+='<div class="filter-total-pages" name="'+o+'"></div>';o>1&&(n+="</div>");return n}ProjectFilters.prototype=Object.create(OipaFilters.prototype)}function IndicatorFilters(){IndicatorFilters.prototype=Object.create(OipaFilters.prototype)}function CPIFilters(){CPIFilters.prototype=Object.create(OipaFilters.prototype)}function OipaUrl(){this.get_selection_from_url=function(){};this.set_current_url=function(){var e=document.URL.toString().split("?")[0]+build_parameters();history.pushState&&history.pushState(null,null,e)};this.build_parameters=function(e){var t="?p=";typeof oipaSelection.sectors!="undefined"&&(t+=build_current_url_add_par("sectors",oipaSelection.sectors));exclude_countries||typeof oipaSelection.countries!="undefined"&&(t+=build_current_url_add_par("countries",oipaSelection.countries));typeof oipaSelection.budgets!="undefined"&&(t+=build_current_url_add_par("budgets",oipaSelection.budgets));typeof oipaSelection.regions!="undefined"&&(t+=build_current_url_add_par("regions",oipaSelection.regions));typeof oipaSelection.indicators!="undefined"&&(t+=build_current_url_add_par("indicators",oipaSelection.indicators));typeof oipaSelection.cities!="undefined"&&(t+=build_current_url_add_par("cities",oipaSelection.cities));typeof oipaSelection.reporting_organisations!="undefined"&&(t+=build_current_url_add_par("reporting_organisations",oipaSelection.reporting_organisations));typeof oipaSelection.offset!="undefined"&&(t+=build_current_url_add_par("offset",oipaSelection.offset));typeof oipaProjectList.per_page!="undefined"&&(t+=build_current_url_add_par("per_page",oipaProjectList.per_page));typeof oipaProjectList.order_by!="undefined"&&(t+=build_current_url_add_par("order_by",oipaProjectList.order_by));typeof oipaProjectList.query!="undefined"&&(t+=build_current_url_add_par("query",oipaProjectList.query));if(t=="?p=")return"";t=t.replace("?p=&","?");return t};this.build_current_url_add_par=function(e,t,n){n===undefined&&(n=",");if(t.length==0)return"";var r="&"+e+"=";for(var i=0;i<t.length;i++)r+=t[i].id.toString()+n;r=r.substr(0,r.length-1);return r}}function OipaVis(){this.type=null;this.data_url=null;this.parameters=new Array;this.export=function(e){new OipaExport(this,e)};this.embed=function(){var e=new OipaEmbed(this)};this.get_url=function(){};this.refresh=function(){}}function OipaTableChart(){OipaTableChart.prototype=Object.create(OipaVis.prototype)}function OipaLineChart(){OipaLineChart.prototype=Object.create(OipaVis.prototype)}function OipaBubbleChart(){OipaBubbleChart.prototype=Object.create(OipaVis.prototype)}function OipaExport(e,t){function n(){}this.visualisation=e;this.filetype=t}function OipaEmbed(e){this.visualisation=e}var Oipa={pageType:null,visualisations:new Array,refresh_visualisations:function(){for(var e=0;e<visualisations.length;e++)visualisations[e].refresh()}},OipaSelectionBox={fill_selection_box:function(){var e="",t="";typeof current_selection.sectors!="undefined"&&current_selection.sectors.length>0&&(e+=fill_selection_box_single_filter("SECTORS",current_selection.sectors));typeof current_selection.countries!="undefined"&&current_selection.countries.length>0&&(e+=fill_selection_box_single_filter("COUNTRIES",current_selection.countries));typeof current_selection.budgets!="undefined"&&current_selection.budgets.length>0&&(e+=fill_selection_box_single_filter("BUDGETS",current_selection.budgets));typeof current_selection.regions!="undefined"&&current_selection.regions.length>0&&(e+=fill_selection_box_single_filter("REGIONS",current_selection.regions));typeof current_selection.cities!="undefined"&&current_selection.cities.length>0&&(e+=fill_selection_box_single_filter("CITIES",current_selection.cities));typeof current_selection.indicators!="undefined"&&current_selection.indicators.length>0&&(t=fill_selection_box_single_filter("INDICATORS",current_selection.indicators));typeof current_selection.reporting_organisations!="undefined"&&current_selection.reporting_organisations.length>0&&(t=fill_selection_box_single_filter("REPORTING_ORGANISATIONS",current_selection.reporting_organisations));typeof current_selection.query!="undefined"&&current_selection.query.length>0&&(e+=fill_selection_box_single_filter("QUERY",current_selection.query));$("#selection-box").html(e);$("#selection-box-indicators").html(t);init_remove_filters_from_selection_box()},fill_selection_box_single_filter:function(e,t){var n='<div class="select-box" id="selected-'+e.toLowerCase()+'">';n+='<div class="select-box-header">';e=="INDICATORS"&&selected_type=="cpi"&&(e="DIMENSIONS");e=="QUERY"&&(e="SEARCH");e=="REPORTING_ORGANISATIONS"&&(e="REPORTING ORGANISATIONS");n+=e;n+="</div>";for(var r=0;r<t.length;r++){n+='<div class="select-box-selected">';n+='<div id="selected-'+t[r].id.toString().replace(/ /g,"").replace(",","").replace("&","").replace("%","perc")+'" class="selected-remove-button"></div>';t[r].name.toString()=="unknown"&&(t[r].name=$(":checkbox[value="+t[r].id+"]").attr("name"));n+="<div>"+t[r].name+"</div>";if(e=="INDICATORS"||e=="DIMENSIONS")n+='<div class="selected-indicator-color-filler"></div><div class="selected-indicator'+(r+1).toString()+'-color"></div>';n+="</div>"}n+="</div>";return n},init_remove_filters_from_selection_box:function(){$(".selected-remove-button").click(function(){var e=$(this).attr("id");e=e.replace("selected-","");var t=$(this).parent().parent().attr("id");t=t.replace("selected-","");var n=current_selection[t];for(var r=0;r<n.length;r++)if(n[r].id==e){$('input[name="'+n[r].name+'"]').attr("checked",!1);break}save_selection()})}};
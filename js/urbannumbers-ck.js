function set_city(e,t){var n=new OipaCity;n.id=e;t==1?OipaCompare.item1=n:t==2&&(OipaCompare.item2=n);url=search_url+"cities/?format=json&id="+e;$.support.cors=!0;if(window.XDomainRequest){var r=new XDomainRequest;r.open("get",url);r.onprogress=function(){};r.ontimeout=function(){};r.onerror=function(){};r.onload=function(){var e=$.parseJSON(r.responseText);if(e==null||typeof e=="undefined"){e=$.parseJSON(data.firstChild.textContent);n.set_compare_data(e)}};setTimeout(function(){r.send()},0)}else $.ajax({type:"GET",url:url,contentType:"application/json",dataType:"json",success:function(e){n.set_compare_data(e)}})}function get_random_city_within_selection(e,t){var n=e[Math.floor(Math.random()*e.length)];t&&n==t&&(n=get_random_city_within_selection(e,t));return n}function geo_point_to_latlng(e){e=e.replace("POINT (","");e=e.substring(0,e.length-1);lnglat=e.split(" ");latlng=[lnglat[1],lnglat[0]];return latlng}function OipaCity(){this.id=null;this.name=null;this.latlng=null;this.set_compare_data=function(e){this.name=e.objects[0].name;this.latlng=geo_point_to_latlng(e.objects[0].location);OipaCompare.refresh_state++;if(OipaCompare.refresh_state>1){OipaCompare.refresh_state=0;OipaCompare.refresh_comparison()}}}$("#main-map .change-basemap-link").click(function(e){e.preventDefault();var t=$(this).attr("name");map.change_basemap(t)});$("#left-map .change-basemap-link").click(function(e){e.preventDefault();var t=$(this).attr("name");leftmap.change_basemap(t)});$("#right-map .change-basemap-link").click(function(e){e.preventDefault();var t=$(this).attr("name");rightmap.change_basemap(t)});$("#compare-cities-randomize").click(function(e){e.preventDefault();selection=[31,92,286,308,617,628,714,1812,1843,2697,5354,5486,5898,6060,6080,6103,6121,6150,6153,6128];var t=get_random_city_within_selection(selection),n=get_random_city_within_selection(selection,t);set_city(t,1);set_city(n,2);console.log(search_url)});var OipaCompare={item1:null,item2:null,refresh_state:0,refresh_comparison:function(){leftmap.map.setView(this.item1.latlng,10);rightmap.map.setView(this.item2.latlng,10);$("#compare-left-title").text(this.item1.name);$("#compare-right-title").text(this.item2.name)}};